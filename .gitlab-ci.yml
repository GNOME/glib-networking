image: registry.gitlab.gnome.org/gnome/glib-networking/master:v3

fedora-x86_64:
  script:
    - meson --prefix=$HOME/glib-networking-installed
            -Db_sanitize=address
            -Dgnutls=enabled
            -Dopenssl=enabled
            -Dlibproxy=enabled
            -Dgnome_proxy=enabled
            -Dwerror=true
            build/
    - ninja -C build/
    - meson test -v -C build/
    - meson --reconfigure -Db_sanitize=none build/
    - ninja -C build/
    - meson test -v -C build/ --repeat=500
    - meson install -C build/
  artifacts:
    paths:
      - build/test-results
    when: on_failure
