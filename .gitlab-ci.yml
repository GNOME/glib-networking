image: fedora:28

variables:
  ADDITIONAL_DEPENDENCIES: gsettings-desktop-schemas gcc

build_stable:
  before_script:
    - dnf update -y --nogpgcheck
    - dnf install -y 'dnf-command(builddep)'
    - dnf builddep -y --nogpgcheck glib-networking
    - dnf install -y --nogpgcheck $ADDITIONAL_DEPENDENCIES
  script:
    - mkdir build
    - cd build
    - meson ..
    - ninja
    - |
      for i in {1..100}; do
        echo "------------------------------------------------------------------------"
        echo "Test run $i"
        echo "------------------------------------------------------------------------"
        ninja test
      done
    - ninja install
  artifacts:
    paths:
      - build/test-results
    when: on_failure
